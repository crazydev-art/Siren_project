FROM python:3.11-slim

#User external ENV during Build of container
ARG MYDIR
ARG USERTABLEJOIN
ARG POSTGRES_USER
ARG NETWORK_DOCKER
ARG POSTGRES_PASSWORD
ARG POSTGRES_DB
ARG IPHOST
ARG POSTGRES_DB_USER
ARG ADMIN_USERNAME
ARG ADMIN_MAIL
ARG ADMIN_PASSWORD

# Define REDPANDA environment variable - .env over docker-compose
ENV MYDIR=${MYDIR}
ENV USERTABLEJOIN=${USERTABLEJOIN}
ENV POSTGRES_USER=${POSTGRES_USER}
ENV NETWORK_DOCKER=${NETWORK_DOCKER}
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV POSTGRES_DB=${POSTGRES_DB}
ENV IPHOST=${IPHOST}
ENV POSTGRES_DB_USER=${POSTGRES_DB_USER}
ENV ADMIN_USERNAME=${ADMIN_USERNAME}
ENV ADMIN_MAIL=${ADMIN_MAIL}
ENV ADMIN_PASSWORD=${ADMIN_PASSWORD}

WORKDIR /fastapi_project

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["./start.sh"]