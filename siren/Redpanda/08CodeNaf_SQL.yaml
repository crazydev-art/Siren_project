http:
  enabled: true
  address: 0.0.0.0:4195
  root_path: /benthos
  debug_endpoints: false

input:
  csv:
    paths: [${FILESIREN}/naf_rev_2.csv]
    parse_header_row: true
    delimiter: ';'

pipeline:
  threads: 8
  processors:
    - mapping: |
        root.codenaf = this.codenaf
        root.nafvfinale = this.nafvfinale
        root.naf65caract = this.naf65caract
        root.naf40caract = this.naf40caract
                
output:
  broker:
    batching:
      count: 4500
      period: 25s
    outputs:
      - sql_insert:
          driver: postgres
          dsn: postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${IPHOST}:5432/${POSTGRES_DB}?sslmode=disable
          table: nafv2
          columns: [codenaf,nafvfinale,naf65caract,naf40caract]
          args_mapping: root = [codenaf,nafvfinale,naf65caract,naf40caract]
          init_statement: |
            CREATE TABLE IF NOT EXISTS nafv2 (
              codenaf VARCHAR(9),
              nafvfinale VARCHAR(150),
              naf65caract VARCHAR(65),
              naf40caract VARCHAR(40),
              primary key (codenaf)
            );

logger:
  level: DEBUG
